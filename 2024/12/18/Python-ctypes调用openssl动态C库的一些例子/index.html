<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Python ctypes调用openssl动态C库的一些例子 | 一个懒惰的倔强</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="AES 256 GCM加解密相关1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969">
<meta property="og:type" content="article">
<meta property="og:title" content="Python ctypes调用openssl动态C库的一些例子">
<meta property="og:url" content="https://hexo.zdu.us.kg/2024/12/18/Python-ctypes%E8%B0%83%E7%94%A8openssl%E5%8A%A8%E6%80%81C%E5%BA%93%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BE%8B%E5%AD%90/index.html">
<meta property="og:site_name" content="一个懒惰的倔强">
<meta property="og:description" content="AES 256 GCM加解密相关1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969">
<meta property="og:locale">
<meta property="article:published_time" content="2024-12-18T02:26:46.000Z">
<meta property="article:modified_time" content="2024-12-18T10:43:42.333Z">
<meta property="article:author" content="XiangYu Chen">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="一个懒惰的倔强" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">一个懒惰的倔强</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://hexo.zdu.us.kg"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Python-ctypes调用openssl动态C库的一些例子" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/12/18/Python-ctypes%E8%B0%83%E7%94%A8openssl%E5%8A%A8%E6%80%81C%E5%BA%93%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BE%8B%E5%AD%90/" class="article-date">
  <time class="dt-published" datetime="2024-12-18T02:26:46.000Z" itemprop="datePublished">2024-12-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Python ctypes调用openssl动态C库的一些例子
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="AES-256-GCM加解密相关"><a href="#AES-256-GCM加解密相关" class="headerlink" title="AES 256 GCM加解密相关"></a>AES 256 GCM加解密相关</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 2012-2019 The OpenSSL Project Authors. All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the OpenSSL license (the &quot;License&quot;).  You may not use</span></span><br><span class="line"><span class="comment"> * this file except in compliance with the License.  You can obtain a copy</span></span><br><span class="line"><span class="comment"> * in the file LICENSE in the source distribution or at</span></span><br><span class="line"><span class="comment"> * https://www.openssl.org/source/license.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Simple AES GCM test program, uses the same NIST data used for the FIPS</span></span><br><span class="line"><span class="comment"> * self test but uses the application level EVP APIs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/bio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/evp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* AES-GCM test data from NIST public test vectors */</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> gcm_key[] = &#123;</span><br><span class="line">    <span class="number">0xee</span>, <span class="number">0xbc</span>, <span class="number">0x1f</span>, <span class="number">0x57</span>, <span class="number">0x48</span>, <span class="number">0x7f</span>, <span class="number">0x51</span>, <span class="number">0x92</span>, <span class="number">0x1c</span>, <span class="number">0x04</span>, <span class="number">0x65</span>, <span class="number">0x66</span>,</span><br><span class="line">    <span class="number">0x5f</span>, <span class="number">0x8a</span>, <span class="number">0xe6</span>, <span class="number">0xd1</span>, <span class="number">0x65</span>, <span class="number">0x8b</span>, <span class="number">0xb2</span>, <span class="number">0x6d</span>, <span class="number">0xe6</span>, <span class="number">0xf8</span>, <span class="number">0xa0</span>, <span class="number">0x69</span>,</span><br><span class="line">    <span class="number">0xa3</span>, <span class="number">0x52</span>, <span class="number">0x02</span>, <span class="number">0x93</span>, <span class="number">0xa5</span>, <span class="number">0x72</span>, <span class="number">0x07</span>, <span class="number">0x8f</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> gcm_iv[] = &#123;</span><br><span class="line">    <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0x3e</span>, <span class="number">0x68</span>, <span class="number">0xed</span>, <span class="number">0x81</span>, <span class="number">0x73</span>, <span class="number">0xa0</span>, <span class="number">0xee</span>, <span class="number">0xd0</span>, <span class="number">0x66</span>, <span class="number">0x84</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> gcm_pt[] = &#123;</span><br><span class="line">    <span class="number">0xf5</span>, <span class="number">0x6e</span>, <span class="number">0x87</span>, <span class="number">0x05</span>, <span class="number">0x5b</span>, <span class="number">0xc3</span>, <span class="number">0x2d</span>, <span class="number">0x0e</span>, <span class="number">0xeb</span>, <span class="number">0x31</span>, <span class="number">0xb2</span>, <span class="number">0xea</span>,</span><br><span class="line">    <span class="number">0xcc</span>, <span class="number">0x2b</span>, <span class="number">0xf2</span>, <span class="number">0xa5</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> gcm_aad[] = &#123;</span><br><span class="line">    <span class="number">0x4d</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0xce</span>, <span class="number">0xc3</span>, <span class="number">0x34</span>, <span class="number">0xb4</span>, <span class="number">0x9b</span>, <span class="number">0xdb</span>, <span class="number">0x37</span>, <span class="number">0x0c</span>, <span class="number">0x43</span>,</span><br><span class="line">    <span class="number">0x7f</span>, <span class="number">0xec</span>, <span class="number">0x78</span>, <span class="number">0xde</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> gcm_ct[] = &#123;</span><br><span class="line">    <span class="number">0xf7</span>, <span class="number">0x26</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0xa8</span>, <span class="number">0x4c</span>, <span class="number">0x0e</span>, <span class="number">0x7c</span>, <span class="number">0xd5</span>, <span class="number">0x36</span>, <span class="number">0x86</span>, <span class="number">0x7e</span>,</span><br><span class="line">    <span class="number">0xb9</span>, <span class="number">0xf2</span>, <span class="number">0x17</span>, <span class="number">0x36</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> gcm_tag[] = &#123;</span><br><span class="line">    <span class="number">0x67</span>, <span class="number">0xba</span>, <span class="number">0x05</span>, <span class="number">0x10</span>, <span class="number">0x26</span>, <span class="number">0x2a</span>, <span class="number">0xe4</span>, <span class="number">0x87</span>, <span class="number">0xd7</span>, <span class="number">0x37</span>, <span class="number">0xee</span>, <span class="number">0x62</span>,</span><br><span class="line">    <span class="number">0x98</span>, <span class="number">0xf7</span>, <span class="number">0x7e</span>, <span class="number">0x0c</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_gcm_encrypt</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    EVP_CIPHER_CTX *ctx;</span><br><span class="line">    <span class="type">int</span> outlen, tmplen;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> outbuf[<span class="number">1024</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;AES GCM Encrypt:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Plaintext:\n&quot;</span>);</span><br><span class="line">    BIO_dump_fp(<span class="built_in">stdout</span>, gcm_pt, <span class="keyword">sizeof</span>(gcm_pt));</span><br><span class="line">    ctx = EVP_CIPHER_CTX_new();</span><br><span class="line">    <span class="comment">/* Set cipher type and mode */</span></span><br><span class="line">    EVP_EncryptInit_ex(ctx, EVP_aes_256_gcm(), <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">/* Set IV length if default 96 bits is not appropriate */</span></span><br><span class="line">    EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_SET_IVLEN, <span class="keyword">sizeof</span>(gcm_iv), <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">/* Initialise key and IV */</span></span><br><span class="line">    EVP_EncryptInit_ex(ctx, <span class="literal">NULL</span>, <span class="literal">NULL</span>, gcm_key, gcm_iv);</span><br><span class="line">    <span class="comment">/* Zero or more calls to specify any AAD */</span></span><br><span class="line">    EVP_EncryptUpdate(ctx, <span class="literal">NULL</span>, &amp;outlen, gcm_aad, <span class="keyword">sizeof</span>(gcm_aad));</span><br><span class="line">    <span class="comment">/* Encrypt plaintext */</span></span><br><span class="line">    EVP_EncryptUpdate(ctx, outbuf, &amp;outlen, gcm_pt, <span class="keyword">sizeof</span>(gcm_pt));</span><br><span class="line">    <span class="comment">/* Output encrypted block */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Ciphertext:\n&quot;</span>);</span><br><span class="line">    BIO_dump_fp(<span class="built_in">stdout</span>, outbuf, outlen);</span><br><span class="line">    <span class="comment">/* Finalise: note get no output for GCM */</span></span><br><span class="line">    EVP_EncryptFinal_ex(ctx, outbuf, &amp;outlen);</span><br><span class="line">    <span class="comment">/* Get tag */</span></span><br><span class="line">    EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_GET_TAG, <span class="number">16</span>, outbuf);</span><br><span class="line">    <span class="comment">/* Output tag */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Tag:\n&quot;</span>);</span><br><span class="line">    BIO_dump_fp(<span class="built_in">stdout</span>, outbuf, <span class="number">16</span>);</span><br><span class="line">    EVP_CIPHER_CTX_free(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_gcm_decrypt</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    EVP_CIPHER_CTX *ctx;</span><br><span class="line">    <span class="type">int</span> outlen, tmplen, rv;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> outbuf[<span class="number">1024</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;AES GCM Decrypt:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Ciphertext:\n&quot;</span>);</span><br><span class="line">    BIO_dump_fp(<span class="built_in">stdout</span>, gcm_ct, <span class="keyword">sizeof</span>(gcm_ct));</span><br><span class="line">    ctx = EVP_CIPHER_CTX_new();</span><br><span class="line">    <span class="comment">/* Select cipher */</span></span><br><span class="line">    EVP_DecryptInit_ex(ctx, EVP_aes_256_gcm(), <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">/* Set IV length, omit for 96 bits */</span></span><br><span class="line">    EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_SET_IVLEN, <span class="keyword">sizeof</span>(gcm_iv), <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">/* Specify key and IV */</span></span><br><span class="line">    EVP_DecryptInit_ex(ctx, <span class="literal">NULL</span>, <span class="literal">NULL</span>, gcm_key, gcm_iv);</span><br><span class="line">    <span class="comment">/* Zero or more calls to specify any AAD */</span></span><br><span class="line">    EVP_DecryptUpdate(ctx, <span class="literal">NULL</span>, &amp;outlen, gcm_aad, <span class="keyword">sizeof</span>(gcm_aad));</span><br><span class="line">    <span class="comment">/* Decrypt plaintext */</span></span><br><span class="line">    EVP_DecryptUpdate(ctx, outbuf, &amp;outlen, gcm_ct, <span class="keyword">sizeof</span>(gcm_ct));</span><br><span class="line">    <span class="comment">/* Output decrypted block */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Plaintext:\n&quot;</span>);</span><br><span class="line">    BIO_dump_fp(<span class="built_in">stdout</span>, outbuf, outlen);</span><br><span class="line">    <span class="comment">/* Set expected tag value. */</span></span><br><span class="line">    EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_SET_TAG, <span class="keyword">sizeof</span>(gcm_tag),</span><br><span class="line">                        (<span class="type">void</span> *)gcm_tag);</span><br><span class="line">    <span class="comment">/* Finalise: note get no output for GCM */</span></span><br><span class="line">    rv = EVP_DecryptFinal_ex(ctx, outbuf, &amp;outlen);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Print out return value. If this is not successful authentication</span></span><br><span class="line"><span class="comment">     * failed and plaintext is not trustworthy.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Tag Verify %s\n&quot;</span>, rv &gt; <span class="number">0</span> ? <span class="string">&quot;Successful!&quot;</span> : <span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">    EVP_CIPHER_CTX_free(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    aes_gcm_encrypt();</span><br><span class="line">    aes_gcm_decrypt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://github.com/openssl/openssl/blob/OpenSSL_1_1_1-stable/demos/evp/aesgcm.c">https://github.com/openssl/openssl/blob/OpenSSL_1_1_1-stable/demos/evp/aesgcm.c</a><br>转换成Python ctypes方式调用如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_void_p, c_char_p, c_int, create_string_buffer, POINTER</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 OpenSSL 动态库</span></span><br><span class="line">libcrypto = ctypes.CDLL(<span class="string">&quot;libcrypto.so&quot;</span>)  <span class="comment"># 根据系统选择动态库路径（Linux）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 OpenSSL 相关的函数原型</span></span><br><span class="line">libcrypto.EVP_CIPHER_CTX_new.restype = c_void_p</span><br><span class="line">libcrypto.EVP_CIPHER_CTX_new.argtypes = []</span><br><span class="line"></span><br><span class="line">libcrypto.EVP_CIPHER_CTX_free.argtypes = [c_void_p]</span><br><span class="line"></span><br><span class="line">libcrypto.EVP_CIPHER_CTX_get_params.argtypes = [c_void_p, POINTER(c_void_p)]</span><br><span class="line">libcrypto.EVP_CIPHER_free.argtypes = [c_void_p]</span><br><span class="line"></span><br><span class="line">libcrypto.EVP_EncryptInit_ex.argtypes = [</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_char_p,</span><br><span class="line">    c_char_p,</span><br><span class="line">]</span><br><span class="line">libcrypto.EVP_EncryptUpdate.argtypes = [</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_char_p,</span><br><span class="line">    POINTER(c_int),</span><br><span class="line">    c_char_p,</span><br><span class="line">    c_int,</span><br><span class="line">]</span><br><span class="line">libcrypto.EVP_EncryptFinal_ex.argtypes = [c_void_p, c_char_p, POINTER(c_int)]</span><br><span class="line"></span><br><span class="line">libcrypto.EVP_DecryptInit_ex.argtypes = [</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_char_p,</span><br><span class="line">    c_char_p,</span><br><span class="line">]</span><br><span class="line">libcrypto.EVP_DecryptUpdate.argtypes = [</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_char_p,</span><br><span class="line">    POINTER(c_int),</span><br><span class="line">    c_char_p,</span><br><span class="line">    c_int,</span><br><span class="line">]</span><br><span class="line">libcrypto.EVP_DecryptFinal_ex.argtypes = [c_void_p, c_char_p, POINTER(c_int)]</span><br><span class="line"></span><br><span class="line">libcrypto.EVP_aes_256_gcm.restype = c_void_p</span><br><span class="line">libcrypto.EVP_aes_256_gcm.argtypes = []</span><br><span class="line"></span><br><span class="line">libcrypto.EVP_CIPHER_fetch.argtypes = [c_void_p, c_char_p, c_void_p]</span><br><span class="line">libcrypto.EVP_CIPHER_fetch.restype = c_void_p</span><br><span class="line"></span><br><span class="line">libcrypto.EVP_CIPHER_CTX_ctrl.argtypes = [c_void_p, c_int, c_int, c_void_p]</span><br><span class="line">libcrypto.EVP_CIPHER_CTX_ctrl.restype = c_int</span><br><span class="line"><span class="comment"># (ctx, EVP_CTRL_AEAD_SET_IVLEN, sizeof(gcm_iv), NULL)</span></span><br><span class="line">libcrypto.BIO_dump_fp.argtypes = [c_void_p, c_void_p, c_int]</span><br><span class="line">libcrypto.BIO_dump_fp.restype = c_int</span><br><span class="line">libcrypto.fopen.argtypes = [c_char_p, c_char_p]</span><br><span class="line">libcrypto.fopen.restype = c_void_p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># AES GCM加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_256_gcm_encrypt</span>(<span class="params">key: <span class="built_in">bytes</span>, iv: <span class="built_in">bytes</span>, plaintext: <span class="built_in">bytes</span>, aad: <span class="built_in">bytes</span> = <span class="string">b&quot;&quot;</span></span>):</span><br><span class="line">    key_ptr = c_char_p(key)</span><br><span class="line">    iv_ptr = c_char_p(iv)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建加密上下文</span></span><br><span class="line">    ctx = libcrypto.EVP_CIPHER_CTX_new()</span><br><span class="line">    cipher = libcrypto.EVP_aes_256_gcm()</span><br><span class="line">    <span class="comment">#    print(11111)</span></span><br><span class="line">    <span class="comment">#    cipher = libcrypto.EVP_CIPHER_fetch(</span></span><br><span class="line">    <span class="comment">#        libctx, c_char_p(b&quot;AES-256-GCM&quot;), propq)</span></span><br><span class="line">    <span class="comment">#    print(ctypes.cast(cipher, c_void_p))</span></span><br><span class="line">    <span class="comment">#    print(11111)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化加密操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2222</span>)</span><br><span class="line">    ls = libcrypto.EVP_EncryptInit_ex(ctx, cipher, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="built_in">print</span>(ls)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2222</span>)</span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_ctrl(ctx, c_int(<span class="number">0x9</span>), c_int(<span class="built_in">len</span>(iv)), <span class="literal">None</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">333</span>)</span><br><span class="line">    libcrypto.EVP_EncryptInit_ex(ctx, <span class="literal">None</span>, <span class="literal">None</span>, key_ptr, iv_ptr)</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">444</span>)</span><br><span class="line">    <span class="comment"># 处理AAD（附加认证数据）</span></span><br><span class="line">    outlen = c_int(<span class="number">0</span>)</span><br><span class="line">    libcrypto.EVP_EncryptUpdate(</span><br><span class="line">        ctx, <span class="literal">None</span>, ctypes.byref(outlen), c_char_p(aad), c_int(<span class="built_in">len</span>(aad))</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">555</span>)</span><br><span class="line">    <span class="comment"># outlen = c_int(0)</span></span><br><span class="line">    <span class="comment"># if not libcrypto.EVP_EncryptUpdate(ctx, None, None, aad_buffer, len(aad)):</span></span><br><span class="line">    <span class="comment">#    raise ValueError(&quot;Error encrypting AAD&quot;)</span></span><br><span class="line">    outbuf = create_string_buffer(<span class="built_in">len</span>(plaintext))</span><br><span class="line">    libcrypto.EVP_EncryptUpdate(</span><br><span class="line">        ctx, outbuf, ctypes.byref(outlen), c_char_p(</span><br><span class="line">            plaintext), c_int(<span class="built_in">len</span>(plaintext))</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">666</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#    # 加密明文</span></span><br><span class="line">    <span class="comment">#    ciphertext = create_string_buffer(len(plaintext))</span></span><br><span class="line">    <span class="comment">#    if not libcrypto.EVP_EncryptUpdate(</span></span><br><span class="line">    <span class="comment">#        ctx, ciphertext, ctypes.byref(outlen), plaintext_buffer, len(plaintext)</span></span><br><span class="line">    <span class="comment">#    ):</span></span><br><span class="line">    <span class="comment">#        raise ValueError(&quot;Error encrypting plaintext&quot;)</span></span><br><span class="line">    <span class="built_in">print</span>(outbuf.raw[: outlen.value].<span class="built_in">hex</span>())</span><br><span class="line">    <span class="comment"># 获取加密后的数据</span></span><br><span class="line">    ciphertext = outbuf.raw[: outlen.value]</span><br><span class="line">    libcrypto.EVP_EncryptFinal_ex(ctx, outbuf, ctypes.byref(outlen))</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">777</span>)</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">    libcrypto.BIO_dump_fp(</span><br><span class="line">        libcrypto.fopen(<span class="string">b&quot;1&quot;</span>, <span class="string">b&quot;w&quot;</span>),</span><br><span class="line">        c_char_p(<span class="string">b&quot;test&quot;</span>),</span><br><span class="line">        <span class="built_in">len</span>(<span class="string">b&quot;test&quot;</span>),</span><br><span class="line">    )</span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_ctrl(ctx, c_int(<span class="number">0x10</span>), c_int(<span class="number">16</span>), outbuf)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取认证标签</span></span><br><span class="line">    <span class="comment">#    #tag = create_string_buffer(16)</span></span><br><span class="line">    <span class="comment">#    if not libcrypto.EVP_EncryptFinal_ex(ctx, tag, ctypes.byref(outlen)):</span></span><br><span class="line">    <span class="comment">#        raise ValueError(&quot;Error finalizing encryption&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 释放上下文</span></span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_free(ctx)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ciphertext, outbuf.raw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># AES GCM 解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_256_gcm_decrypt</span>(<span class="params"></span></span><br><span class="line"><span class="params">    key: <span class="built_in">bytes</span>, iv: <span class="built_in">bytes</span>, ciphertext: <span class="built_in">bytes</span>, aad: <span class="built_in">bytes</span> = <span class="string">b&quot;&quot;</span>, tag: <span class="built_in">bytes</span> = <span class="string">b&quot;&quot;</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;tag:&quot;</span>, tag.<span class="built_in">hex</span>())</span><br><span class="line">    ctx = libcrypto.EVP_CIPHER_CTX_new()</span><br><span class="line">    libcrypto.EVP_DecryptInit_ex(</span><br><span class="line">        ctx, libcrypto.EVP_aes_256_gcm(), <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_ctrl(ctx, c_int(<span class="number">0x9</span>), <span class="built_in">len</span>(iv), <span class="literal">None</span>)</span><br><span class="line">    libcrypto.EVP_DecryptInit_ex(ctx, <span class="literal">None</span>, <span class="literal">None</span>, c_char_p(key), c_char_p(iv))</span><br><span class="line">    outlen = c_int(<span class="number">0</span>)</span><br><span class="line">    libcrypto.EVP_DecryptUpdate(</span><br><span class="line">        ctx, <span class="literal">None</span>, ctypes.byref(outlen), c_char_p(aad), <span class="built_in">len</span>(aad)</span><br><span class="line">    )</span><br><span class="line">    outbuf = create_string_buffer(<span class="built_in">len</span>(ciphertext))</span><br><span class="line">    libcrypto.EVP_DecryptUpdate(</span><br><span class="line">        ctx, outbuf, ctypes.byref(outlen), c_char_p(</span><br><span class="line">            ciphertext), <span class="built_in">len</span>(ciphertext)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Plaintext:\n&quot;</span>)</span><br><span class="line">    <span class="comment"># BIO_dump_fp(stdout, outbuf, outlen);</span></span><br><span class="line">    <span class="built_in">print</span>(outbuf.raw)</span><br><span class="line">    text = outbuf.raw[: outlen.value]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;tag:&quot;</span>, tag)</span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_ctrl(ctx, c_int(<span class="number">0x10</span>), <span class="built_in">len</span>(tag), c_char_p(tag))</span><br><span class="line">    rv = libcrypto.EVP_DecryptFinal_ex(ctx, outbuf, ctypes.byref(outlen))</span><br><span class="line">    <span class="built_in">print</span>(rv)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 释放解密上下文</span></span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_free(ctx)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试数据</span></span><br><span class="line">key = <span class="string">b&quot;77889900112233445566778899001122&quot;</span></span><br><span class="line"><span class="built_in">print</span>(key.<span class="built_in">hex</span>())</span><br><span class="line">iv = <span class="string">b&quot;778899001122&quot;</span></span><br><span class="line"><span class="built_in">print</span>(iv.<span class="built_in">hex</span>())</span><br><span class="line">plaintext = <span class="string">b&quot;1231&quot;</span></span><br><span class="line"><span class="built_in">print</span>(plaintext.<span class="built_in">hex</span>())</span><br><span class="line">aad = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密过程</span></span><br><span class="line">ciphertext, tag = aes_256_gcm_encrypt(key, iv, plaintext, aad)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Ciphertext: <span class="subst">&#123;ciphertext.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Tag: <span class="subst">&#123;tag.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ciphertext = base64.b64decode(</span><br><span class="line">    <span class="string">b&quot;BGDr211pjM/koptwkyQ7iXWTBqVf1R89Z19MPY2QiIv4/h/UNXuDjjc+uQ/9ZkJqdOfZ8MH/j+P907tbTFJhYyyd2+dqyEzBSEKq8RlpZIbHyYcnw6XRdA4c4HiAcB0ZzW8Qu3gMnH3DydMSNHwx1r7oEGewL/2SgejQemo3wK7BlpKWAJ7oX/pXCrS3JRRKHE8QG6piJLyUBB+GwuggNbE7sev7StGjezNoD2y0w0gTagKfF4C/5bVxmxbDX+DFSTfPIwA7KhRa58Vm3vL2kf+RBi1/aL9SA2+a1E6uJEAt/EEzZJ+4UJPljqIkQOAEwmD99ijG1smrRfmMkXdwmEOYeckYNwoUQbPv1wOI40UfOh2etmu9nzmuSsoNDWGJza9x4CwOXlIHvPbZtBbYO20mBy0W2byx7dh+vGbzeLgBJ8IWbHc50DNAV6GA/sxifcZPZs8USn42WoKtuKqrUVq28H+faCNvaVdSbI+ZUSG6F/euDMVdguWMlfub4J3KLxC346MDCRoX6bEXG3J4+Mo7JPi+xfoh2JKewHF2D4RgJIEkPt9ffhEDKG7jtJGSzYYqfKBEVU2/vDuGV8Y+nHmsGFcbCiM1I7onmMS1L977O0UEMwvz8cIjnXd9kRMhGrBU6yR0DvEZ67K3a5wCxbwEbNaWPy5n2oDUF3mWESXSMSIgdN6qcgpok95xegLmcEkKtp4MYdd/cT7IS2qtWJmNJKiAqg==&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">tag = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">iv = base64.b64decode(<span class="string">b&quot;eorS/CBlfWrqeWWj&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(iv.<span class="built_in">hex</span>())</span><br><span class="line">key = <span class="string">b&quot;4e3b9ft1a68eb6548af9y895c1b14ad5&quot;</span></span><br><span class="line"><span class="comment"># 解密过程</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    decrypted_plaintext = aes_256_gcm_decrypt(key, iv, ciphertext, aad, tag)</span><br><span class="line">    <span class="built_in">print</span>(decrypted_plaintext[:-<span class="number">16</span>])</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="RSA非对称加解密相关，使用chatgpt生成手动修护了异常和错误"><a href="#RSA非对称加解密相关，使用chatgpt生成手动修护了异常和错误" class="headerlink" title="RSA非对称加解密相关，使用chatgpt生成手动修护了异常和错误"></a>RSA非对称加解密相关，使用chatgpt生成手动修护了异常和错误</h2><h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_char_p, c_void_p, POINTER</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 OpenSSL 动态库（Linux 下通常是 libcrypto.so）</span></span><br><span class="line">libcrypto = ctypes.CDLL(<span class="string">&quot;libcrypto.so&quot;</span>)  <span class="comment"># 根据系统调整库的路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 C 函数原型</span></span><br><span class="line">libcrypto.PEM_read_RSAPrivateKey.argtypes = [</span><br><span class="line">    c_void_p,</span><br><span class="line">    POINTER(c_void_p),</span><br><span class="line">    c_void_p,</span><br><span class="line">    c_void_p,</span><br><span class="line">]</span><br><span class="line">libcrypto.PEM_read_RSAPrivateKey.restype = c_void_p  <span class="comment"># 返回类型是 RSA*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开私钥文件的 C 函数</span></span><br><span class="line">libcrypto.fopen.argtypes = [c_char_p, c_char_p]</span><br><span class="line">libcrypto.fopen.restype = c_void_p  <span class="comment"># 返回 FILE*，即 void*</span></span><br><span class="line"><span class="comment"># 定义 C 函数原型</span></span><br><span class="line">libcrypto.BN_bn2hex.argtypes = [c_void_p]</span><br><span class="line">libcrypto.BN_bn2hex.restype = c_char_p  <span class="comment"># 返回类型是 C 字符串</span></span><br><span class="line"></span><br><span class="line">libcrypto.BN_bn2dec.argtypes = [c_void_p]</span><br><span class="line">libcrypto.BN_bn2dec.restype = c_char_p  <span class="comment"># 返回类型是 C 字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> libcrypto.fopen(filename.encode(<span class="string">&quot;utf-8&quot;</span>), <span class="string">b&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RSA_get0_key: 获取 RSA 密钥的模数和公钥指数</span></span><br><span class="line">libcrypto.RSA_get0_key.argtypes = [</span><br><span class="line">    c_void_p,</span><br><span class="line">    POINTER(c_void_p),</span><br><span class="line">    POINTER(c_void_p),</span><br><span class="line">    c_void_p,</span><br><span class="line">]</span><br><span class="line">libcrypto.RSA_get0_key.restype = <span class="literal">None</span>  <span class="comment"># 返回类型是 void</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印 RSA 密钥信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_rsa_info</span>(<span class="params">rsa</span>):</span><br><span class="line">    <span class="keyword">if</span> rsa <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;RSA key is NULL.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取模数和公钥指数</span></span><br><span class="line">    n = c_void_p()</span><br><span class="line">    e = c_void_p()</span><br><span class="line">    libcrypto.RSA_get0_key(rsa, ctypes.byref(n), ctypes.byref(e), <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打印模数 (n)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RSA Key Info:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  Modulus (n):&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 sys.stdout 获取 FILE* 类型</span></span><br><span class="line">    n_hex = libcrypto.BN_bn2hex(n)</span><br><span class="line">    <span class="built_in">print</span>(n_hex.decode())  <span class="comment"># 打印十六进制表示</span></span><br><span class="line">    <span class="comment"># libcrypto.BN_print_fp(stdout_fp, n)  # 输出到标准输出</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n  Public exponent (e):&quot;</span>)</span><br><span class="line">    e_hex = libcrypto.BN_bn2hex(e)</span><br><span class="line">    <span class="built_in">print</span>(e_hex.decode())  <span class="comment"># 打印十六进制表示</span></span><br><span class="line">    <span class="comment"># libcrypto.BN_print_fp(stdout_fp, e)  # 输出到标准输出</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取 RSA 密钥的大小</span></span><br><span class="line">    bits = (</span><br><span class="line">        libcrypto.RSA_size(ctypes.cast(rsa, c_void_p)) * <span class="number">8</span></span><br><span class="line">    )  <span class="comment"># RSA_size 返回字节数，乘以 8 转换为位数</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  Key size: <span class="subst">&#123;bits&#125;</span> bits&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误打印函数</span></span><br><span class="line">libcrypto.ERR_print_errors_fp.argtypes = [c_void_p]</span><br><span class="line">libcrypto.ERR_print_errors_fp.restype = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载私钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_private_key</span>(<span class="params">privkey_filename</span>):</span><br><span class="line">    <span class="comment"># 打开文件</span></span><br><span class="line">    privkey_file = open_file(privkey_filename)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> privkey_file:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Unable to open private key file&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加载 RSA 私钥</span></span><br><span class="line">    rsa = libcrypto.PEM_read_RSAPrivateKey(privkey_file, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> rsa:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Unable to load private key&quot;</span>)</span><br><span class="line">        libcrypto.ERR_print_errors_fp(<span class="literal">None</span>)  <span class="comment"># 输出 OpenSSL 错误</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Private key loaded successfully from <span class="subst">&#123;privkey_filename&#125;</span>.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> rsa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">privkey_filename = <span class="string">&quot;private_key.pem&quot;</span></span><br><span class="line">rsa_privkey = load_private_key(privkey_filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rsa_privkey:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Private key loaded successfully&quot;</span>)</span><br><span class="line">    print_rsa_info(rsa_privkey)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed to load private key&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分块加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_rsa</span>(<span class="params">rsa, data</span>):</span><br><span class="line">    rsa_len = libcrypto.RSA_size(ctypes.cast(rsa, c_void_p))</span><br><span class="line">    block_size = rsa_len - <span class="number">11</span>  <span class="comment"># 最大加密块大小：RSA_size - 填充空间</span></span><br><span class="line"></span><br><span class="line">    encrypted_data = ctypes.create_string_buffer(</span><br><span class="line">        rsa_len * ((<span class="built_in">len</span>(data) // block_size) + <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    data_len = <span class="built_in">len</span>(data)</span><br><span class="line">    encrypted_len = <span class="number">0</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> i &lt; data_len:</span><br><span class="line">        chunk_len = <span class="built_in">min</span>(block_size, data_len - i)</span><br><span class="line">        <span class="comment"># 对当前块进行加密</span></span><br><span class="line">        len_encrypted = libcrypto.RSA_private_encrypt(</span><br><span class="line">            chunk_len,</span><br><span class="line">            ctypes.byref(ctypes.create_string_buffer(data[i: i + chunk_len])),</span><br><span class="line">            ctypes.byref(encrypted_data, encrypted_len),</span><br><span class="line">            ctypes.cast(rsa, c_void_p),</span><br><span class="line">            <span class="number">1</span>,  <span class="comment"># RSA_PKCS1_OAEP_PADDING</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len_encrypted == -<span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;RSA encryption failed&quot;</span>)</span><br><span class="line">            libcrypto.ERR_print_errors_fp(sys.stderr)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        encrypted_len += len_encrypted</span><br><span class="line">        i += chunk_len</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> encrypted_data.raw[:encrypted_len]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 待加密的数据</span></span><br><span class="line"><span class="comment"># data = b&quot;Hello, RSA encryption! This is a long message that will be split into multiple blocks.&quot;</span></span><br><span class="line">data = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">test_-------TEST</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original Data (length: <span class="subst">&#123;<span class="built_in">len</span>(data)&#125;</span>):\n<span class="subst">&#123;data.decode()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line">encrypted_data = encrypt_rsa(rsa_privkey, data)</span><br><span class="line"><span class="keyword">if</span> encrypted_data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nEncrypted Data (length: <span class="subst">&#123;<span class="built_in">len</span>(encrypted_data)&#125;</span>):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot; &quot;</span>.join(<span class="string">f&quot;<span class="subst">&#123;byte:02x&#125;</span>&quot;</span> <span class="keyword">for</span> byte <span class="keyword">in</span> encrypted_data))</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(encrypted_data))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_char_p, c_void_p, POINTER</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 OpenSSL 动态库（Linux 下通常是 libcrypto.so）</span></span><br><span class="line">libcrypto = ctypes.CDLL(<span class="string">&quot;libcrypto.so&quot;</span>)  <span class="comment"># 根据系统调整库的路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于错误处理</span></span><br><span class="line">libcrypto.ERR_print_errors_fp.argtypes = [c_void_p]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开私钥文件的 C 函数</span></span><br><span class="line">libcrypto.fopen.argtypes = [c_char_p, c_char_p]</span><br><span class="line">libcrypto.fopen.restype = c_void_p  <span class="comment"># 返回 FILE*，即 void*</span></span><br><span class="line"><span class="comment"># 定义 C 函数原型</span></span><br><span class="line">libcrypto.BN_bn2hex.argtypes = [c_void_p]</span><br><span class="line">libcrypto.BN_bn2hex.restype = c_char_p  <span class="comment"># 返回类型是 C 字符串</span></span><br><span class="line"></span><br><span class="line">libcrypto.BN_bn2dec.argtypes = [c_void_p]</span><br><span class="line">libcrypto.BN_bn2dec.restype = c_char_p  <span class="comment"># 返回类型是 C 字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> libcrypto.fopen(filename.encode(<span class="string">&quot;utf-8&quot;</span>), <span class="string">b&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RSA_get0_key: 获取 RSA 密钥的模数和公钥指数</span></span><br><span class="line">libcrypto.RSA_get0_key.argtypes = [</span><br><span class="line">    c_void_p,</span><br><span class="line">    POINTER(c_void_p),</span><br><span class="line">    POINTER(c_void_p),</span><br><span class="line">    c_void_p,</span><br><span class="line">]</span><br><span class="line">libcrypto.RSA_get0_key.restype = <span class="literal">None</span>  <span class="comment"># 返回类型是 void</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印 RSA 密钥信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_rsa_info</span>(<span class="params">rsa</span>):</span><br><span class="line">    <span class="keyword">if</span> rsa <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;RSA key is NULL.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取模数和公钥指数</span></span><br><span class="line">    n = c_void_p()</span><br><span class="line">    e = c_void_p()</span><br><span class="line">    libcrypto.RSA_get0_key(rsa, ctypes.byref(n), ctypes.byref(e), <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打印模数 (n)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RSA Key Info:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  Modulus (n):&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 sys.stdout 获取 FILE* 类型</span></span><br><span class="line">    n_hex = libcrypto.BN_bn2hex(n)</span><br><span class="line">    <span class="built_in">print</span>(n_hex.decode())  <span class="comment"># 打印十六进制表示</span></span><br><span class="line">    <span class="comment"># libcrypto.BN_print_fp(stdout_fp, n)  # 输出到标准输出</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n  Public exponent (e):&quot;</span>)</span><br><span class="line">    e_hex = libcrypto.BN_bn2hex(e)</span><br><span class="line">    <span class="built_in">print</span>(e_hex.decode())  <span class="comment"># 打印十六进制表示</span></span><br><span class="line">    <span class="comment"># libcrypto.BN_print_fp(stdout_fp, e)  # 输出到标准输出</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取 RSA 密钥的大小</span></span><br><span class="line">    bits = (</span><br><span class="line">        libcrypto.RSA_size(ctypes.cast(rsa, c_void_p)) * <span class="number">8</span></span><br><span class="line">    )  <span class="comment"># RSA_size 返回字节数，乘以 8 转换为位数</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  Key size: <span class="subst">&#123;bits&#125;</span> bits&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 C 函数原型</span></span><br><span class="line">libcrypto.PEM_read_RSA_PUBKEY.argtypes = [</span><br><span class="line">    c_void_p, c_void_p, c_void_p, c_void_p]</span><br><span class="line">libcrypto.PEM_read_RSA_PUBKEY.restype = c_void_p  <span class="comment"># 返回 RSA 对象指针</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 RSA 公钥并打印信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_public_key</span>(<span class="params">pubkey_filename</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 打开文件并加载公钥</span></span><br><span class="line">        public_file = open_file(pubkey_filename)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> public_file:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Unable to open private key file&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 创建 C 字符串指针，指向文件内容</span></span><br><span class="line">        <span class="comment"># buffer = ctypes.create_string_buffer(file_data)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 加载 RSA 公钥</span></span><br><span class="line">        rsa1 = libcrypto.PEM_read_RSA_PUBKEY(public_file, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> rsa1:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed to load public key.&quot;</span>)</span><br><span class="line">            libcrypto.ERR_print_errors_fp(sys.stderr)  <span class="comment"># 打印 OpenSSL 错误</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Public key loaded successfully from <span class="subst">&#123;pubkey_filename&#125;</span>.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> rsa1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;An error occurred: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">pubkey_filename = <span class="string">&quot;public_key.pem&quot;</span></span><br><span class="line">rsa_pubkey = load_public_key(pubkey_filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rsa_pubkey:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Private key loaded successfully&quot;</span>)</span><br><span class="line">    print_rsa_info(rsa_pubkey)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed to load private key&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分块解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_rsa</span>(<span class="params">rsa, encrypted_data</span>):</span><br><span class="line">    rsa_len = libcrypto.RSA_size(ctypes.cast(rsa, c_void_p))</span><br><span class="line">    block_size = rsa_len</span><br><span class="line">    encrypted_len = <span class="built_in">len</span>(encrypted_data)</span><br><span class="line"></span><br><span class="line">    decrypted_data = ctypes.create_string_buffer(encrypted_len)</span><br><span class="line"></span><br><span class="line">    decrypted_len = <span class="number">0</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> i &lt; encrypted_len:</span><br><span class="line">        <span class="comment"># 对当前块进行解密</span></span><br><span class="line">        len_decrypted = libcrypto.RSA_public_decrypt(</span><br><span class="line">            block_size,</span><br><span class="line">            ctypes.byref(</span><br><span class="line">                ctypes.create_string_buffer(encrypted_data[i: i + block_size])</span><br><span class="line">            ),</span><br><span class="line">            ctypes.byref(decrypted_data, decrypted_len),</span><br><span class="line">            ctypes.cast(rsa, c_void_p),</span><br><span class="line">            <span class="number">1</span>,  <span class="comment"># RSA_PKCS1_OAEP_PADDING</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len_decrypted == -<span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;RSA decryption failed&quot;</span>)</span><br><span class="line">            libcrypto.ERR_print_errors_fp(sys.stderr)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        decrypted_len += len_decrypted</span><br><span class="line">        i += block_size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decrypted_data.raw[:decrypted_len]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">encrypted_base64 = <span class="string">b&quot;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&quot;</span></span><br><span class="line">encrypted_data = base64.b64decode(encrypted_base64)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">decrypted_data = decrypt_rsa(rsa_pubkey, encrypted_data)</span><br><span class="line"><span class="keyword">if</span> decrypted_data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nDecrypted Data:\n<span class="subst">&#123;decrypted_data.decode()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hexo.zdu.us.kg/2024/12/18/Python-ctypes%E8%B0%83%E7%94%A8openssl%E5%8A%A8%E6%80%81C%E5%BA%93%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BE%8B%E5%AD%90/" data-id="cm4trgyl300001vsbhzhn7ucw" data-title="Python ctypes调用openssl动态C库的一些例子" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/01/07/freerdp%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E4%BA%92%E7%9B%B8%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4%E6%96%87%E4%BB%B6%E7%9A%84%E6%93%8D%E4%BD%9C/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          freerdp连接远程主机互相复制粘贴文件的操作
        
      </div>
    </a>
  
  
    <a href="/2024/11/25/k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%9C%A8Ubuntu%E4%B8%8B%E9%83%A8%E7%BD%B2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">k8s二进制在Ubuntu下部署</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">March 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/03/13/%E8%BF%91%E6%9C%9F%E7%A0%94%E7%A9%B6Xdea%E8%AF%95%E7%94%A8%E6%BF%80%E6%B4%BB%E7%9A%84%E6%80%BB%E7%BB%93/">近期研究Xdea激活的总结</a>
          </li>
        
          <li>
            <a href="/2025/01/10/ttyd%E9%85%8D%E5%90%88lrzsz-trzsz%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/">ttyd配合lrzsz/trzsz实现文件传输</a>
          </li>
        
          <li>
            <a href="/2025/01/09/%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%A4%9A%E5%87%BA%E5%8F%A3%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1/">虚拟机多出口提供服务</a>
          </li>
        
          <li>
            <a href="/2025/01/07/cloudflare-workerd%E6%8A%8A%E7%8E%A9-%E7%BC%96%E8%AF%91workerd%EF%BC%88%E4%B8%80%EF%BC%89/">cloudflare workerd把玩-编译workerd（一）</a>
          </li>
        
          <li>
            <a href="/2025/01/07/freerdp%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E4%BA%92%E7%9B%B8%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4%E6%96%87%E4%BB%B6%E7%9A%84%E6%93%8D%E4%BD%9C/">freerdp连接远程主机互相复制粘贴文件的操作</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 XiangYu Chen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>